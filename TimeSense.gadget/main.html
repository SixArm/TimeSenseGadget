<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=Unicode" />
    <style>
        body {
            margin: 0;
            width: 130px;
            height: 90px;
            background-color: #222;
            font-size: 1em;
            overflow: hidden;
            color: #aaa; }
            
        a, a:hover, a:visited, a:focus {
            outline: 0 none; }
        a:focus {
            outline: 1px solid lime}
        
        #content {
            margin: 0;
            padding: 0.2em;
            border: 1px solid #777 }
            
        .texty-timekeeper {
            border: #fff }
            
            .texty-timekeeper .indicator {
                font-family: Arial;
                letter-spacing: 1px;
                color: #777;
                background-color: #000;
                padding-left: 0.05em;
                padding-bottom: 0.1em;
                margin-bottom: 0.1em;
                border-bottom: 1px solid #555; }
                
                .texty-timekeeper .indicator.max {
                    color: #33cc33 }
                .texty-timekeeper .indicator.high {
                    color: #669900 }
                .texty-timekeeper .indicator.mid {
                    color: #ff9933 }
                .texty-timekeeper .indicator.low {
                    color: #cc0000 }
                .texty-timekeeper .indicator.empty {
                    color: #ccc }
                
            .texty-timekeeper .info {
                font-family: Tahoma;
                font-size: 0.9em;
                padding-top: 0.1em; }
                
                .texty-timekeeper .info .nag {
                    font-size: 90%;
                    margin-top: 0.25em;
                    margin-bottom: 0.3em }
                .texty-timekeeper .info .date {
                    height: 35px;
                    display: none }
                .texty-timekeeper .info .event {
                    height: 35px }
                .texty-timekeeper .info .date a,
                .texty-timekeeper .info .event a {
                    color: #aaa;
                    text-decoration: none;
                    cursor: default }
                .texty-timekeeper .info .date a:hover,
                .texty-timekeeper .info .event a:hover {
                    color: #eee }
    </style>
</head>
<body>
    <div id="content"></div>
</body>
<script type="text/html" id="texty-timekeeper-html">
    <div class="{type}-timekeeper">
        <div class="indicator {hint} {tracker.percent}">{progress}</div>
        <div class="info">
            <div class="nag">{nag}</div>
            <div class="date" title="Click to show event"><a id="show-event" href="">{date}</a></div>
            <div class="event" title="Click to show date"><a id="show-date" href="">{event}</a></div>
        </div>
    </div>
</script>
<script type="text/javascript" src="lib/underscore.date.js"></script>
<script type="text/javascript" src="lib/zyx.js"></script>
<script type="text/javascript" src="timesense.js"></script>
<script type="text/javascript">
    var template = $('#texty-timekeeper-html').html();
    
    _date.relativeTime.future = "%s to";
    _date.relativeTime.past = "%s since";
    
    function getTextyProgress(percent) {
        var marker = '|';
        var maxMarkers = 30;

        var limit = (percent / 100) * maxMarkers;
        var progress = '';
        for (i=1; i<=limit; i++) {
            progress += marker;
        }
        return progress;
    }
    
    function getHint(percent) {
        if (percent = 100) {
            return 'max';
        }
        if (percent >= 60 && percent <= 99) {
            return 'high';
        }
        if (percent >= 30 && percent <= 59) {
            return 'mid';
        }
        if (percent >= 1 && percent <= 29) {
            return 'low';
        }
        if (percent = 0) {
            return 'empty';
        }
    }
    
    var clock = new Timekeeper({
        event: "The New Year!",
        type: 'texty',
        reference: new Date(2011, 6, 1),
        focus: new Date(2012, 0, 1),
        interval: 1000 * 60,
        onTick: function() {
            $('#content').html(this.render(template));
        },
        viewModel: function() {
            var model = this.toJSON();
            var progress = getTextyProgress(model.tracker.percent);
            model.progress = progress == '' ? '&nbsp;' : progress;
            model.hint = getHint(model.tracker.percent);
            model.nag = _date(model.slice.focus).from(Date.now());
            model.date = _date(model.slice.focus).format("ddd, MMM Do YYYY h:mm:ss a"); 
            return model;
        }
    });
    clock.tick();
    clock.start();
    
    document.onclick = function(e) {
        if (window.event.srcElement.id === 'show-date') {
            $('.date').show();
            $('.event').hide();
            window.event.returnValue = false;
            return false;
        }
        if (window.event.srcElement.id === 'show-event') {
            $('.event').show();
            $('.date').hide();
            window.event.returnValue = false;
            return false;
        }
    };
</script>
</html>
